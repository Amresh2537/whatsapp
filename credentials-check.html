<!DOCTYPE html>
<html>
<head>
    <title>WhatsApp Credentials Checker</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .error { background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success { background: #f0fdf4; border: 1px solid #bbf7d0; color: #16a34a; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { background: #fffbeb; border: 1px solid #fed7aa; color: #d97706; padding: 15px; border-radius: 5px; margin: 10px 0; }
        input, button { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background: #16a34a; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #15803d; }
        .result { margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 5px; }
        pre { background: #1f2937; color: #f9fafb; padding: 15px; border-radius: 5px; overflow: auto; font-size: 12px; }
        .step { margin: 15px 0; padding: 15px; border-left: 4px solid #3b82f6; background: #eff6ff; }
        .step h4 { margin: 0 0 10px 0; color: #1d4ed8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç WhatsApp Business API Credentials Checker</h1>
        <p>This tool will help you verify your WhatsApp Business API credentials and find the correct IDs.</p>
        
        <div class="step">
            <h4>Step 1: Enter Your Access Token</h4>
            <p>Get this from your Facebook Developer Console ‚Üí Your App ‚Üí WhatsApp ‚Üí Getting Started</p>
            <input type="password" id="accessToken" placeholder="Enter your WhatsApp Access Token">
            <button onclick="checkCredentials()">Check Credentials</button>
        </div>

        <div id="results"></div>

        <div class="step">
            <h4>üìã Instructions to Fix Your Setup:</h4>
            <ol>
                <li><strong>Get Your Access Token:</strong>
                    <ul>
                        <li>Go to <a href="https://developers.facebook.com/" target="_blank">Facebook Developer Console</a></li>
                        <li>Select your WhatsApp Business API app</li>
                        <li>Go to WhatsApp ‚Üí Getting Started</li>
                        <li>Copy the permanent access token (not the temporary one)</li>
                    </ul>
                </li>
                <li><strong>Find Your Business Account ID:</strong>
                    <ul>
                        <li>In Facebook Business Manager</li>
                        <li>Go to Business Settings ‚Üí Business Info</li>
                        <li>Copy the Business ID (not the Business Account ID shown in ads)</li>
                    </ul>
                </li>
                <li><strong>Get Your Phone Number ID:</strong>
                    <ul>
                        <li>In Facebook Developer Console ‚Üí Your App ‚Üí WhatsApp</li>
                        <li>Find your phone number in the list</li>
                        <li>Copy the Phone Number ID (not the actual phone number)</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <script>
        async function checkCredentials() {
            const accessToken = document.getElementById('accessToken').value;
            const resultsDiv = document.getElementById('results');
            
            if (!accessToken) {
                resultsDiv.innerHTML = '<div class="error">Please enter your access token first.</div>';
                return;
            }
            
            resultsDiv.innerHTML = '<div>üîÑ Checking credentials...</div>';
            
            try {
                // Test 1: Get user's businesses
                const businessResponse = await fetch(`https://graph.facebook.com/v19.0/me/businesses?access_token=${accessToken}`);
                const businessData = await businessResponse.json();
                
                let html = '<h3>üìä Credential Check Results:</h3>';
                
                if (businessResponse.ok && businessData.data) {
                    html += '<div class="success">‚úÖ Access token is valid!</div>';
                    
                    if (businessData.data.length > 0) {
                        html += '<div class="success">‚úÖ Found ' + businessData.data.length + ' business account(s)</div>';
                        
                        // Test 2: Get WhatsApp Business Accounts for each business
                        for (const business of businessData.data) {
                            try {
                                const waResponse = await fetch(`https://graph.facebook.com/v19.0/${business.id}?fields=whatsapp_business_accounts{id,name,business_verification_status,phone_numbers{id,display_phone_number,verified_name,quality_rating}}&access_token=${accessToken}`);
                                const waData = await waResponse.json();
                                
                                if (waResponse.ok && waData.whatsapp_business_accounts) {
                                    html += `<div class="result">
                                        <h4>üè¢ Business: ${business.name} (ID: ${business.id})</h4>`;
                                    
                                    if (waData.whatsapp_business_accounts.data.length > 0) {
                                        waData.whatsapp_business_accounts.data.forEach(waba => {
                                            html += `
                                                <div class="success">
                                                    <strong>üì± WhatsApp Business Account:</strong> ${waba.name}<br>
                                                    <strong>üÜî Business Account ID (use this):</strong> <code>${waba.id}</code><br>
                                                    <strong>‚úÖ Verification Status:</strong> ${waba.business_verification_status}<br>
                                            `;
                                            
                                            if (waba.phone_numbers && waba.phone_numbers.data.length > 0) {
                                                waba.phone_numbers.data.forEach(phone => {
                                                    html += `
                                                        <strong>üìû Phone:</strong> ${phone.display_phone_number}<br>
                                                        <strong>üÜî Phone Number ID (use this):</strong> <code>${phone.id}</code><br>
                                                        <strong>üìõ Verified Name:</strong> ${phone.verified_name}<br>
                                                        <strong>‚≠ê Quality Rating:</strong> ${phone.quality_rating || 'N/A'}<br>
                                                    `;
                                                });
                                            } else {
                                                html += '<div class="warning">‚ö†Ô∏è No phone numbers found for this WhatsApp Business Account</div>';
                                            }
                                            html += '</div>';
                                        });
                                    } else {
                                        html += '<div class="warning">‚ö†Ô∏è No WhatsApp Business Accounts found for this business</div>';
                                    }
                                    html += '</div>';
                                }
                            } catch (error) {
                                html += `<div class="error">‚ùå Error checking WhatsApp accounts for business ${business.name}: ${error.message}</div>`;
                            }
                        }
                    } else {
                        html += '<div class="error">‚ùå No businesses found. Make sure your access token has the correct permissions.</div>';
                    }
                    
                    html += `
                        <div class="step">
                            <h4>üîß What to do next:</h4>
                            <ol>
                                <li>Copy the <strong>Business Account ID</strong> from above</li>
                                <li>Copy the <strong>Phone Number ID</strong> from above</li>
                                <li>Use these in your WhatsApp SaaS platform settings</li>
                                <li>Make sure your access token has these permissions:
                                    <ul>
                                        <li>whatsapp_business_messaging</li>
                                        <li>whatsapp_business_management</li>
                                        <li>business_management</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                    `;
                    
                } else {
                    html += `<div class="error">‚ùå Access token is invalid or expired.<br>Error: ${businessData.error ? businessData.error.message : 'Unknown error'}</div>`;
                }
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Error checking credentials: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
